<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{residentMenu :: head}">
    
</head>

<body onload="disableBookedButtons()">
    <!-- Navigation -->
    <div th:replace="~{residentMenu :: nav}"></div>

    <div class="container">
        <h2 class="text-center mb-4">Available Apartments</h2>

        <!-- Success Message -->
        <div th:if="${message}" class="alert alert-success" role="alert">
            <span th:text="${message}"></span>
        </div>

        <!-- Apartments Listing -->
        <div class="card-container">
            <div class="card" th:each="apartment : ${apartments}">
                <img th:if="${apartment.imageUrl}" th:src="@{${apartment.imageUrl}}" alt="Apartment Image" class="apartment-img" />
                <img th:unless="${apartment.imageUrl}" src="https://source.unsplash.com/400x200/?apartment-building" alt="Default Apartment" class="apartment-img" />

                <div class="card-body">
                    <h5 class="card-title" th:text="${apartment.name}">Apartment Name</h5>
                    <p class="card-text"><strong>Location:</strong> <span th:text="${apartment.location}"></span></p>
                    <p class="card-text"><strong>Price:</strong> â‚¹<span th:text="${apartment.price}"></span></p>
                    <p class="card-text"><strong>Status:</strong>
                        <span th:if="${apartment.isAvailable}" class="text-success">Available</span>
                        <span th:unless="${apartment.isAvailable}" class="text-danger">Not Available</span>
                    </p>
                    <p class="card-text"><strong>Description:</strong> <span th:text="${apartment.description}"></span></p>
                    <p class="card-text"><strong>Created At:</strong> <span th:text="${apartment.createdAt}"></span></p>

                    <!-- Booking Button -->
                    <form th:id="'bookForm-' + ${apartment.id}" action="/front-end/apartments/bookApartment" method="post">
                        <input type="hidden" name="apartmentId" th:value="${apartment.id}" />
                        <button type="button"
                                class="btn btn-book w-100 mt-2"
                                th:id="'bookButton-' + ${apartment.id}"
                                th:classappend="${apartment.isAvailable ? '' : ' booked'}"
                                th:attr="onclick=${apartment.isAvailable} ? 'confirmBooking(' + ${apartment.id} + ')' : null"
                                th:disabled="${!apartment.isAvailable}">
                            <span th:text="${apartment.isAvailable ? 'Book Now' : 'Booked'}">Book Now</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

   <div th:insert="~{residentMenu :: span}"></div>
    <script>
        function confirmBooking(apartmentId) {
            if (confirm("Are you sure you want to book this apartment?")) {
                let button = document.getElementById('bookButton-' + apartmentId);
                button.disabled = true;
                button.innerText = 'Booked';
                button.classList.add('booked');
                document.getElementById('bookForm-' + apartmentId).submit();
            }
        }

        function disableBookedButtons() {
            const buttons = document.querySelectorAll('.booked');
            buttons.forEach(btn => {
                btn.disabled = true;
                btn.innerText = 'Booked';
            });
        }
    </script>
</body>
</html>
