<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Apartment Listings</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
        function confirmBooking(apartmentId) {
            // Show the confirmation pop-up
            if (confirm("Are you sure you want to book this apartment?")) {
                // Disable the button and change the text after confirming the booking
                let button = document.getElementById('bookButton-' + apartmentId);
                button.disabled = true;
                button.innerText = 'Booked';
                
                // Submit the form
                document.getElementById('bookForm-' + apartmentId).submit();
            }
        }

        // Disable the booking button once the page is loaded if the apartment is already booked
        function disableBookedButtons() {
            const bookedButtons = document.querySelectorAll('.booked');
            bookedButtons.forEach(function(button) {
                button.disabled = true;
                button.innerText = 'Booked';
            });
        }
    </script>
</head>
<body class="container mt-5" onload="disableBookedButtons()">
    <!-- Include the navigation menu -->
    <div th:replace="~{residentMenu :: nav}"></div>

    <h2 class="mb-4">Available Apartments</h2>

    <!-- Success Message -->
    <div th:if="${message}" class="alert alert-success" role="alert">
        <span th:text="${message}"></span>
    </div>

    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Location</th>
                <th>Price</th>
                <th>Availability</th>
                <th>Description</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="apartment : ${apartments}">
                <td th:text="${apartment.id}"></td>
                <td th:text="${apartment.name}"></td>
                <td th:text="${apartment.location}"></td>
                <td th:text="${apartment.price}"></td>
                <td>
                    <span th:text="${apartment.isAvailable} ? 'Available' : 'Not Available'"></span>
                </td>
                <td th:text="${apartment.description}"></td>
                <td>
                    <form th:id="'bookForm-' + ${apartment.id}" action="/front-end/apartments/bookApartment" method="post">
                        <input type="hidden" name="apartmentId" th:value="${apartment.id}" />
                        
                        <!-- Check if the apartment is available, if not, disable the button -->
                        <button type="button" class="btn btn-primary" 
                            th:id="'bookButton-' + ${apartment.id}"
                            th:classappend="${apartment.isAvailable ? '' : ' booked'}"
                            th:attr="onclick='confirmBooking(' + ${apartment.id} + ');'"
                            th:disabled="${!apartment.isAvailable}">
                            Book
                        </button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>

</body>
</html>
