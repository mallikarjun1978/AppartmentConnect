<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>View Facilities</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

    <style>
        body {
            background-color: #f4f7fa;
        }
        .container {
            margin-top: 30px;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background: #ffffff;
        }
        .table th {
            background-color: darkcyan;
            color: white;
            text-align: center;
        }
        .table td {
            text-align: center;
        }
        .btn-primary {
            background-color: #007bff;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .btn-danger {
            background-color: #e74c3c;
            border: none;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .modal-content {
            border-radius: 15px;
        }
        .dataTables_filter input {
            border-radius: 20px;
            padding: 8px 12px;
        }
        .dataTables_paginate .paginate_button {
            border-radius: 20px;
            padding: 5px 10px;
        }
        .hover-effect:hover {
            background-color: #f1f1f1;
        }
        .action-btn {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .action-btn button {
            padding: 8px 12px;
            font-size: 14px;
        }
		/* Custom dark blue navbar */
				.navbar {
					background-color: royalblue !important;
					/* Dark blue background */
				}

				/* Navbar links color: white */
				.navbar-nav .nav-item .nav-link {
					color: white !important;
					/* White text */
				}

				/* Navbar links hover effect */
				.navbar-nav .nav-item .nav-link:hover {
					color: #d1e7fd !important;
					/* Light blue color on hover */
					text-decoration: underline;
					/* Optional: add underline on hover */
				}

				/* Adjusting navbar toggler icon color */
				.navbar .navbar-toggler-icon {
					background-color: white;
					/* White color for the toggler icon */
				}

				/* Optional: add some space between icons and text */
				.nav-link i {
					margin-right: 8px;
				}
				.container {
				    box-shadow: 0 4px 8px rgba(0, 86, 179, 0.5); /* Blue shadow with transparency */
				}


    </style>
</head>
<body>
    <!-- Include the navigation menu -->
    <div th:insert="~{adminmenu :: nav}"></div>

    <div class="container">
        <div class="card">
            <div class="card-body">
                <h2 class="text-center mb-4">Facilities List</h2>
                <table id="facilitiesTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Available Time</th>
                            <th>Max Capacity</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="facility : ${facilities}" class="hover-effect">
                            <td th:text="${facility.facilityId}"></td>
                            <td th:text="${facility.facilityName}"></td>
                            <td th:text="${facility.description}"></td>
                            <td th:text="${facility.availableTime}"></td>
                            <td th:text="${facility.maxCapacity}"></td>
                            <td th:text="${facility.isActive ? 'Active' : 'Inactive'}"></td>
                            <td class="action-btn">
                                <button class="btn btn-primary btn-sm edit-btn" 
                                        th:data-id="${facility.facilityId}" 
                                        th:data-name="${facility.facilityName}"
                                        th:data-description="${facility.description}"
                                        th:data-time="${facility.availableTime}"
                                        th:data-capacity="${facility.maxCapacity}"
                                        th:data-active="${facility.isActive}">
                                    <i class="fa fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-danger btn-sm delete-btn" th:data-id="${facility.facilityId}">
                                    <i class="fa fa-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="editModalLabel">Edit Facility</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editFacilityId">
                        <div class="mb-3">
                            <label for="facilityName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="facilityName" required>
                        </div>
                        <div class="mb-3">
                            <label for="facilityDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="facilityDescription" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="facilityTime" class="form-label">Available Time</label>
                            <input type="text" class="form-control" id="facilityTime" required>
                        </div>
                        <div class="mb-3">
                            <label for="maxCapacity" class="form-label">Max Capacity</label>
                            <input type="number" class="form-control" id="maxCapacity" min="1" required>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="facilityStatus">
                            <label class="form-check-label" for="facilityStatus">Active</label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Edit functionality
            $('.edit-btn').on('click', function () {
                const facilityId = $(this).data('id');
                const facilityName = $(this).data('name');
                const facilityDescription = $(this).data('description');
                const facilityTime = $(this).data('time');
                const maxCapacity = $(this).data('capacity');
                const isActive = $(this).data('active');

                $('#editFacilityId').val(facilityId);
                $('#facilityName').val(facilityName);
                $('#facilityDescription').val(facilityDescription);
                $('#facilityTime').val(facilityTime);
                $('#maxCapacity').val(maxCapacity);
                $('#facilityStatus').prop('checked', isActive);

                $('#editModal').modal('show');
            });

            // Update facility
			// Update facility
			$('#editForm').on('submit', function (e) {
			    e.preventDefault();
			    const facilityId = $('#editFacilityId').val();
				const isActive = $('#facilityStatus').is(':checked') ? true : false;
				const updatedFacility = {
				    facilityId: facilityId,
				    facilityName: $('#facilityName').val(),
				    description: $('#facilityDescription').val(),
				    availableTime: $('#facilityTime').val(),
				    maxCapacity: parseInt($('#maxCapacity').val()),
				    isActive: $('#facilityStatus').is(':checked')
					
				};

				console.log('Checkbox checked:', $('#facilityStatus').is(':checked'));
				console.log('updatedFacility', updatedFacility);
				
			    $.ajax({
			        url: `/edit/${facilityId}`, 
			        type: 'POST',
			        contentType: 'application/json',
			        data: JSON.stringify(updatedFacility),
			        success: function (response) {
			            alert('Facility updated successfully!');
			            location.reload();
			        },
			        error: function () {
			            alert('Failed to update facility.');
			        }
			    });
			});
            // Delete functionality
            $('.delete-btn').on('click', function () {
                const facilityId = $(this).data('id');
                if (confirm('Are you sure you want to delete this facility?')) {
                    $.ajax({
                        url: `/delete/${facilityId}`,
                        type: 'GET',
                        success: function (response) {
                            alert(response);
                            location.reload();
                        },
                        error: function (xhr) {
                            alert('Failed to delete facility. ' + xhr.responseText);
                        }
                    });
                }
            });

            // DataTables Initialization
            $('#facilitiesTable').DataTable({
                paging: true,
                searching: true,
                ordering: true,
                info: true,
                responsive: true,
                columnDefs: [{ targets: -1, orderable: false }]
            });
        });
    </script>
</body>
</html>
